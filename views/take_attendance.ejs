<%- include('partials/_header') %>
<%- include('partials/_nav', { user: user }) %>

<main class="container">
    <div class="form-container">
        <h1>Select Class for Attendance</h1>
        <form id="attendanceForm" method="POST">
            <div class="form-group">
                <label for="classId">Select Class</label>
                <select id="classId" name="classId" class="form-control" required onchange="updateSubjects()">
                    <option value="">-- Select a Class --</option>
                    <% classes.forEach(c => { %>
                        <option value="<%= c._id %>" data-subjects="<%= c.subjects.join(',') %>"><%= c.name %></option>
                    <% }); %>
                </select>
            </div>

            <div class="form-group">
                <label for="subject">Select Subject</label>
                <select id="subject" name="subject" class="form-control" required></select>
            </div>

            <div class="form-group">
                <label for="session">Select Session</label>
                <select id="session" name="session" class="form-control" required>
                    <% sessions.forEach(session => { %>
                        <option value="<%= session.name %>"><%= session.name %></option>
                    <% }); %>
                    <% if (sessions.length === 0) { %>
                        <option value="" disabled selected>No sessions available. Please contact admin.</option>
                    <% } %>
                </select>
            </div>

            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" class="form-control" value="<%= new Date().toISOString().split('T')[0] %>" required>
            </div>

            <div class="btn-group">
                <button type="button" onclick="submitForm('/teacher/attendance/sheet')" class="btn btn-primary">Manual Entry</button>
                <button type="button" onclick="submitForm('/teacher/attendance/qr-scanner')" class="btn btn-info">QR Code Scan</button>
            </div>
        </form>
    </div>
</main>
<script>
    function updateSubjects() {
        const classSelect = document.getElementById('classId');
        const subjectSelect = document.getElementById('subject');
        const selectedOption = classSelect.options[classSelect.selectedIndex];
        
        subjectSelect.innerHTML = '';
        
        if (selectedOption.value) {
            const subjects = selectedOption.dataset.subjects.split(',');
            subjects.forEach(subject => {
                const option = new Option(subject.trim(), subject.trim());
                subjectSelect.add(option);
            });
        }
    }

    function submitForm(action) {
        const form = document.getElementById('attendanceForm');
        form.action = action;
        form.submit();
    }
    
    // Initialize subjects for the first class on page load
    document.addEventListener('DOMContentLoaded', updateSubjects);
</script>

</body>
</html>