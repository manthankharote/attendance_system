<%- include('partials/_header') %>
<%- include('partials/_nav', { user: user }) %>

<main class="container">
    <div class="page-header">
        <h1>Manage Users</h1>
        <a href="/admin/users/add" class="btn btn-primary">Add New User</a>
    </div>

    <div class="search-container">
        <form action="/admin/users" method="GET">
            <input type="text" name="search" placeholder="Search by name, email, or ID..." value="<%= searchQuery %>">
            <button type="submit" class="btn btn-info">Search</button>
        </form>
    </div>

    <div class="card">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>School ID</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% managedUsers.forEach(u => { %>
                        <tr>
                            <td><%= u.name %></td>
                            <td><%= u.schoolId %></td>
                            <td><%= u.email %></td>
                            <td><%= u.role.charAt(0).toUpperCase() + u.role.slice(1) %></td>
                            <td class="action-buttons">
                                <a href="/admin/users/edit/<%= u._id %>" class="btn btn-warning">Edit</a>
                                <form action="/admin/users/delete/<%= u._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this user?');">
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>

    <% if (totalPages > 1) { %>
        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/admin/users?page=<%= currentPage - 1 %>&search=<%= searchQuery %>" class="btn">&laquo; Prev</a>
            <% } %>

            <% for (let i = 1; i <= totalPages; i++) { %>
                <a href="/admin/users?page=<%= i %>&search=<%= searchQuery %>" class="btn <%= i === currentPage ? 'btn-primary' : 'btn-secondary' %>"><%= i %></a>
            <% } %>

            <% if (currentPage < totalPages) { %>
                <a href="/admin/users?page=<%= currentPage + 1 %>&search=<%= searchQuery %>" class="btn">Next &raquo;</a>
            <% } %>
        </div>
    <% } %>
</main>

</body>
</html>