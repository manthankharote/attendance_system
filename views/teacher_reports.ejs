<%- include('partials/_header') %>
<%- include('partials/_nav', { user: user }) %>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<main class="container">
    <h1>My Attendance Reports</h1>

    <div class="card">
        <h2>Filters</h2>
        <form action="/teacher/reports" method="GET" class="filter-form">
            <div class="form-group">
                <label for="classId">Filter by Class</label>
                <select name="classId" id="classId">
                    <option value="">All My Classes</option>
                    <% classes.forEach(c => { %>
                        <option value="<%= c._id %>" <%= (filters.classId == c._id) ? 'selected' : '' %>><%= c.name %></option>
                    <% }); %>
                </select>
            </div>
            <div class="form-group">
                <label for="studentId">Filter by Student</label>
                <select name="studentId" id="studentId">
                    <option value="">All My Students</option>
                    <% students.forEach(s => { %>
                        <option value="<%= s._id %>" <%= (filters.studentId == s._id) ? 'selected' : '' %>><%= s.name %> (<%= s.schoolId %>)</option>
                    <% }); %>
                </select>
            </div>
            <div class="form-group">
                <label for="startDate">Start Date</label>
                <input type="date" name="startDate" id="startDate" value="<%= filters.startDate || '' %>">
            </div>
            <div class="form-group">
                <label for="endDate">End Date</label>
                <input type="date" name="endDate" id="endDate" value="<%= filters.endDate || '' %>">
            </div>
            <div class="button-group">
                <button type="submit" class="btn btn-primary">Apply Filters</button>
                <a href="/teacher/reports" class="btn btn-secondary">Clear Filters</a>
            </div>
        </form>
    </div>

    <div class="card">
        <h2>Results</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Student Name</th>
                        <th>Class</th>
                        <th>Subject</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <% records.forEach(record => { %>
                        <tr>
                            <td><%= new Date(record.date).toLocaleDateString() %></td>
                            <td><%= record.studentDetails.name %></td>
                            <td><%= record.classDetails.name %></td>
                            <td><%= record.subject %></td>
                            <td style="color: <%= record.records.status === 'Present' ? 'green' : 'red' %>;">
                                <%= record.records.status %>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>
</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function() {
        $('#classId').select2();
        $('#studentId').select2();
    });
</script>
</body>
</html>